<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>World Population Map</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body { margin: auto; width: 80%; padding: 10px; }
        path {
            stroke: #fff;
            stroke-width: 1px;
            fill: #ccc;
        }
    </style>
</head>
<body>
    <h1>World Population Map</h1>
    <div id="chart"></div>
    <script>
        function init() {
            const w = 960;
            const h = 500;

            const projection = d3.geoMercator()
                                 .translate([w / 2, h / 2])
                                 .scale(150);

            const path = d3.geoPath()
                           .projection(projection);

            const svg = d3.select("#chart")
                          .append("svg")
                          .attr("width", w)
                          .attr("height", h);

            // Load and process external data
            Promise.all([
                d3.json("world_countries.json"),
                d3.csv("world-population.csv")
            ]).then(function([json, data]) {
                const populationByCountry = {};
                data.forEach(d => {
                    populationByCountry[d.Country] = +d.Population;
                });

                // Set the color scale
                const colorScale = d3.scaleQuantize()
                    .domain([0, d3.max(data, d => +d.Population)])
                    .range(d3.schemeBlues[9]);

                // Create a tooltip
                const tooltip = d3.select("body").append("div")
                    .attr("class", "tooltip")
                    .style("position", "absolute")
                    .style("z-index", "10")
                    .style("visibility", "hidden")
                    .style("background", "#fff")
                    .style("border", "1px solid #000")
                    .style("padding", "5px");

                // Bind the data and create one path per GeoJSON feature
                svg.selectAll("path")
                    .data(json.features)
                    .join("path")
                    .attr("d", path)
                    .style("fill", d => {
                        const value = populationByCountry[d.properties.name];
                        return value ? colorScale(value) : "#ccc";
                    })
                    .on("mouseover", function(event, d) {
                        tooltip.html(`Country: ${d.properties.name}<br>Population: ${populationByCountry[d.properties.name] || "No data"}`)
                            .style("visibility", "visible");
                    })
                    .on("mousemove", function(event) {
                        tooltip.style("top", (event.pageY - 10) + "px")
                               .style("left", (event.pageX + 10) + "px");
                    })
                    .on("mouseout", function() {
                        tooltip.style("visibility", "hidden");
                    });
            }).catch(error => console.error("Error loading data:", error));
        }

        window.onload = init;
    </script>
</body>
</html>
